{% extends 'base.html.twig' %}

{% block title %}Hopital | Rendez-Vous
{% endblock %}

{% block base_content %}


{#	<div class="card mb-3">#}
{#		<div class="card-body">#}
{#			<div class="row justify-content-between align-items-center">#}
{#				<div class="col-md">#}
{#					<h5 class="mb-2 mb-md-0 text-nowrap">Rendez-vous {{ rendezVous.code }}</h5>#}
{#				</div>#}

{#				<div class="col-md">#}
{#					<button class="btn btn-falcon-default btn-sm me-1 mb-2 mb-sm-0" type="button">#}
{#						<span class="fas fa-arrow-down me-1"> </span>Download (.pdf)</button>#}
{#					<button class="btn btn-falcon-default btn-sm me-1 mb-2 mb-sm-0" type="button">#}
{#						<span class="fas fa-print me-1"> </span>Print</button>#}


{#				</div>#}
{#			</div>#}
{#		</div>#}
{#	</div>#}

	<div class="card mb-3">
		<div class="card-header bg-light">
			<p class="fs--1 mb-0"><strong>{{ rendezVous.code }}</strong>

			</p>
		</div>
		<div class="card-body">

			<div class="row align-items-center">
				<div class="col">
					<h6 class="text-500">Invoice to</h6>
					<h5>Antonio Banderas</h5>
					<p class="fs--1">1954 Bloor Street West<br />Torronto ON, M6P 3K9<br />Canada</p>
					<p class="fs--1"><a href="mailto:example@gmail.com">example@gmail.com</a><br /><a href="tel:444466667777">+4444-6666-7777</a></p>
				</div>
				<div class="col-sm-auto ms-auto">
					<div class="table-responsive">
						<table class="table table-sm table-borderless fs--1">
							<tbody>
							<tr>
								<th class="text-sm-end">Invoice No:</th>
								<td>14</td>
							</tr>
							<tr>
								<th class="text-sm-end">Order Number:</th>
								<td>AD20294</td>
							</tr>
							<tr>
								<th class="text-sm-end">Invoice Date:</th>
								<td>2018-09-25</td>
							</tr>
							<tr>
								<th class="text-sm-end">Payment Due:</th>
								<td>Upon receipt</td>
							</tr>
							<tr class="alert-success fw-bold">
								<th class="text-sm-end">Amount Due:</th>
								<td>$19688.40</td>
							</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
{#			<div class="table-responsive scrollbar mt-4 fs--1">#}
{#				<table class="table table-striped border-bottom">#}
{#					<thead class="light">#}
{#					<tr class="bg-primary text-white dark__bg-1000">#}
{#						<th class="border-0">Products</th>#}
{#						<th class="border-0 text-center">Quantity</th>#}
{#						<th class="border-0 text-end">Rate</th>#}
{#						<th class="border-0 text-end">Amount</th>#}
{#					</tr>#}
{#					</thead>#}
{#					<tbody>#}
{#					<tr>#}
{#						<td class="align-middle">#}
{#							<h6 class="mb-0 text-nowrap">Platinum web hosting package</h6>#}
{#							<p class="mb-0">Down 35mb, Up 100mb</p>#}
{#						</td>#}
{#						<td class="align-middle text-center">2</td>#}
{#						<td class="align-middle text-end">$65.00</td>#}
{#						<td class="align-middle text-end">$130.00</td>#}
{#					</tr>#}
{#					<tr>#}
{#						<td class="align-middle">#}
{#							<h6 class="mb-0 text-nowrap">2 Page website design</h6>#}
{#							<p class="mb-0">Includes basic wireframes and responsive templates</p>#}
{#						</td>#}
{#						<td class="align-middle text-center">1</td>#}
{#						<td class="align-middle text-end">$2,100.00</td>#}
{#						<td class="align-middle text-end">$2,100.00</td>#}
{#					</tr>#}
{#					<tr>#}
{#						<td class="align-middle">#}
{#							<h6 class="mb-0 text-nowrap">Mobile App Development</h6>#}
{#							<p class="mb-0">Includes responsive navigation</p>#}
{#						</td>#}
{#						<td class="align-middle text-center">8</td>#}
{#						<td class="align-middle text-end">$5,00.00</td>#}
{#						<td class="align-middle text-end">$4,000.00</td>#}
{#					</tr>#}
{#					<tr>#}
{#						<td class="align-middle">#}
{#							<h6 class="mb-0 text-nowrap">Web App Development</h6>#}
{#							<p class="mb-0">Includes react spa</p>#}
{#						</td>#}
{#						<td class="align-middle text-center">6</td>#}
{#						<td class="align-middle text-end">$2,000.00</td>#}
{#						<td class="align-middle text-end">$12,000.00</td>#}
{#					</tr>#}
{#					</tbody>#}
{#				</table>#}
{#			</div>#}
{#			<div class="row justify-content-end">#}
{#				<div class="col-auto">#}
{#					<table class="table table-sm table-borderless fs--1 text-end">#}
{#						<tr>#}
{#							<th class="text-900">Subtotal:</th>#}
{#							<td class="fw-semi-bold">$18,230.00 </td>#}
{#						</tr>#}
{#						<tr>#}
{#							<th class="text-900">Tax 8%:</th>#}
{#							<td class="fw-semi-bold">$1458.40</td>#}
{#						</tr>#}
{#						<tr class="border-top">#}
{#							<th class="text-900">Total:</th>#}
{#							<td class="fw-semi-bold">$19688.40</td>#}
{#						</tr>#}
{#						<tr class="border-top border-top-2 fw-bolder text-900">#}
{#							<th>Amount Due:</th>#}
{#							<td>$19688.40</td>#}
{#						</tr>#}
{#					</table>#}
{#				</div>#}
{#			</div>#}
		</div>

	</div>

	<div class="modal fade" id="addEventModal" tabindex="-1">
		<div class="modal-dialog modal-lg">
			<div class="modal-content border">
				<form id="addEventForm" autocomplete="off">
					<div class="modal-header px-card bg-primary border-bottom-0">
						<h5 class="modal-title text-white">Créer un rendez-vous</h5>
						<button class="btn-close me-n1" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body p-card">


						<div class="row">

							<div class="mb-3 col-6">

								<label class="fs-0" for="fnMeetingMedecin">Medecin</label>

								<select class="form-select fnMeeting js-choice" id="fnMeetingMedecin" size="1"  data-options='{"removeItemButton":true,"placeholder":true}'>
									<option value="" selected="selected">----</option>
									{% for medecin in medecins %}
										<option value="{{ medecin.id }}" >{{ medecin.nom }} {{ medecin.prenom }}</option>
									{% endfor %}
								</select>
							</div>

							<div class="mb-3 col-6">

								<label class="fs-0" for="fnMeetingPatient">Patient</label>

								<select class="form-select fnMeeting js-choice" id="fnMeetingPatient" size="1" data-options='{"removeItemButton":true,"placeholder":true}'>
									<option value="" selected="selected">----</option>
									{% for patient in patients %}
										<option value="{{ patient.id }}" >{{ patient.nom }} {{ patient.prenom }}</option>
									{% endfor %}
								</select>

							</div>

							<div class="mb-3 col-6">

							<label class="fs-0" for="fnMeetingAssurance">Assurance</label>

							<select class="form-select fnMeeting js-choice" id="fnMeetingAssurance" size="1"  data-options='{"removeItemButton":true,"placeholder":true}'>
								<option value="" selected="selected">----</option>

								{% for assurance in assurances %}
									<option value="{{ assurance.id }}" >{{ assurance.libelle }}</option>
								{% endfor %}
							</select>

						</div>
						<div class="mb-3 col-6">
							<label class="fs-0" for="fnMeetingDate">Date de rendez-vous</label>
							<input class="form-control datetimepicker flatpickr-input fnMeeting" id="fnMeetingDate" value="{{ 'now'|date('Y-m-d') }}"  type="date" required="required" name="startDate" />
						</div>
							<div class="mb-3 col-12">

							<label class="fs-0" for="fnMeetingPrestation">Prestation</label>

							<select class="form-select fnMeeting js-choice" id="fnMeetingPrestation"  size="1"  data-options='{"removeItemButton":true,"placeholder":true}'>
								<option value="">----</option>

								{% for prestation in prestations %}
									<option value="{{ prestation.id }}" >{{ prestation.libelle }}</option>
								{% endfor %}
							</select>

						</div>





							<div class="mb-3 col-12">
								<label class="fs-0" for="fnMeetingPourcentage"> % Assurance</label>
								<input class="form-control fnMeeting " id="fnMeetingPourcentage" type="number" max="100" required="required" />
							</div>





							<div class="mb-3">
								<label class="fs-0" for="fnMeetingDescription">Commentaire</label>
								<textarea class="form-control fnMeeting" rows="3" id="fnMeetingDescription"></textarea>
							</div>

						</div>


					</div>

					<div class="card-footer d-flex justify-content-end align-items-center bg-light">

						<button class="btn btn-primary px-4" id="btnCreateMeeting" type="button">Enregistrer</button>
					</div>
				</form>
			</div>
		</div>
	</div>




{% endblock %}
{% block addjs %}
	<script>

		$(function () {

			let btnCreatePatient = $('#btnCreatePatient'), btnCreateMeeting = $('#btnCreateMeeting')


			function CreatePatient() {

				let form = JSON.stringify({
				nom: $('#fnPatientNom').val(),
				prenom: $('#fnPatientPrenom').val(), 
				contact: $('#fnPatientContact').val(), 
				adresse: $('#fnPatientAdresse').val()})

				console.log("form", form)
				requestPost('{{ path('patients_ctrl_create') }}', form, '.fnPatient', '#btnCreatePatient').then(() => 
				{
					iziToast.destroy();
					iziToast.success({title: 'Succès', message: "Le patient a été créé avec succès", position: 'topRight'});
					location.reload();

				});
			}

			function CreateMeeting() {

				let form = JSON.stringify({
				fk_medecin: $('#fnMeetingMedecin').val(),
				fk_patient: $('#fnMeetingPatient').val(),
				fk_assurance: $('#fnMeetingAssurance').val(),
				fk_prestation: $('#fnMeetingPrestation').val(),
				pourcentage: $('#fnMeetingPourcentage').val(),
				date_rendez_vous: $('#fnMeetingDate').val(),
				description: $('#fnMeetingDescription').val(),
				

				})

				console.log("form", form)
				requestPost('{{ path('meetings_ctrl_create') }}', form, '.fnMeeting', '#btnCreatePatient').then(() => 
				{
					iziToast.destroy();
					iziToast.success({title: 'Succès', message: "Le patient a été créé avec succès", position: 'topRight'});
					location.reload();

				});
			}

			btnCreatePatient.on('click', function () {

				CreatePatient();
			});


			btnCreateMeeting.on('click', function () {

			CreateMeeting();
			});

			var events = [

				{% for rendezVousItem in rendezVous %}

					{
				title: "{{ rendezVousItem.code }}",
				start: "{{ rendezVousItem.dateRendezVous|date('Y-m-d') }}",
				
				description: 'The starting of the programming contest',
				className: '{{ rendezVousItem.statutTextClassName }}',
				url: 'http://google.com'
				}, 

				{% endfor %}

				];

			var meetingCalendarInit = function meetingCalendarInit() {

				var Selectors = {
				ACTIVE: '.active',
				ADD_EVENT_FORM: '#addEventForm',
				ADD_EVENT_MODAL: '#addEventModal',
				CALENDAR: '#meetingCalendar',
				CALENDAR_TITLE: '.calendar-title',
				DATA_CALENDAR_VIEW: '[data-fc-view]',
				DATA_EVENT: '[data-event]',
				DATA_VIEW_TITLE: '[data-view-title]',
				EVENT_DETAILS_MODAL: '#eventDetailsModal',
				EVENT_DETAILS_MODAL_CONTENT: '#eventDetailsModal .modal-content',
				EVENT_START_DATE: '#addEventModal [name="startDate"]',
				INPUT_TITLE: '[name="title"]'
				};
				var Events = {
				CLICK: 'click',
				SHOWN_BS_MODAL: 'shown.bs.modal',
				SUBMIT: 'submit'
				};
				var DataKeys = {
				EVENT: 'event',
				FC_VIEW: 'fc-view'
				};
				var ClassNames = {
				ACTIVE: 'active'
				};
				var eventList = events.reduce(function (acc, val) {
				return val.schedules ? acc.concat(val.schedules.concat(val)) : acc.concat(val);
				}, []);
			
				var updateTitle = function updateTitle(title) {
				document.querySelector(Selectors.CALENDAR_TITLE).textContent = title;
				};
			
				var meetingCalendar = document.querySelector(Selectors.CALENDAR);
				var addEventForm = document.querySelector(Selectors.ADD_EVENT_FORM);
				var addEventModal = document.querySelector(Selectors.ADD_EVENT_MODAL);
				var eventDetailsModal = document.querySelector(Selectors.EVENT_DETAILS_MODAL);
			
				if (meetingCalendar) {
				var calendar = renderCalendar(meetingCalendar, {
					headerToolbar: false,
					dayMaxEvents: 2,
					height: 800,
					stickyHeaderDates: false,
					views: {
					week: {
						eventLimit: 3
					}
					},
					eventTimeFormat: {
					hour: 'numeric',
					minute: '2-digit',
					omitZeroMinute: true,
					meridiem: true
					},
					events: eventList,
					eventClick: function eventClick(info) {
					if (info.event.url) {
						window.open(info.event.url, '_blank');
						info.jsEvent.preventDefault();
					} else {
						var template = getTemplate(info.event);
						document.querySelector(Selectors.EVENT_DETAILS_MODAL_CONTENT).innerHTML = template;
						var modal = new window.bootstrap.Modal(eventDetailsModal);
						modal.show();
					}
					},
					dateClick: function dateClick(info) {
					var modal = new window.bootstrap.Modal(addEventModal);
					modal.show();
					/*eslint-disable-next-line*/
			
					var flatpickr = document.querySelector(Selectors.EVENT_START_DATE)._flatpickr;
			
					flatpickr.setDate([info.dateStr]);
					}
				});
				updateTitle(calendar.currentData.viewTitle);
				document.querySelectorAll(Selectors.DATA_EVENT).forEach(function (button) {
					button.addEventListener(Events.CLICK, function (e) {
					var el = e.currentTarget;
					var type = utils.getData(el, DataKeys.EVENT);
			
					switch (type) {
						case 'prev':
						calendar.prev();
						updateTitle(calendar.currentData.viewTitle);
						break;
			
						case 'next':
						calendar.next();
						updateTitle(calendar.currentData.viewTitle);
						break;
			
						case 'today':
						calendar.today();
						updateTitle(calendar.currentData.viewTitle);
						break;
			
						default:
						calendar.today();
						updateTitle(calendar.currentData.viewTitle);
						break;
					}
					});
				});
				document.querySelectorAll(Selectors.DATA_CALENDAR_VIEW).forEach(function (link) {
					link.addEventListener(Events.CLICK, function (e) {
					e.preventDefault();
					var el = e.currentTarget;
					var text = el.textContent;
					el.parentElement.querySelector(Selectors.ACTIVE).classList.remove(ClassNames.ACTIVE);
					el.classList.add(ClassNames.ACTIVE);
					document.querySelector(Selectors.DATA_VIEW_TITLE).textContent = text;
					calendar.changeView(utils.getData(el, DataKeys.FC_VIEW));
					updateTitle(calendar.currentData.viewTitle);
					});
				});
				addEventForm && addEventForm.addEventListener(Events.SUBMIT, function (e) {
					e.preventDefault();
					var _e$target = e.target,
						title = _e$target.title,
						startDate = _e$target.startDate,
						endDate = _e$target.endDate,
						label = _e$target.label,
						description = _e$target.description,
						allDay = _e$target.allDay;
					calendar.addEvent({
					title: title.value,
					start: startDate.value,
					end: endDate.value ? endDate.value : null,
					allDay: allDay.checked,
					className: allDay.checked && label.value ? "bg-soft-".concat(label.value) : '',
					description: description.value
					});
					e.target.reset();
					window.bootstrap.Modal.getInstance(addEventModal).hide();
				});
				}
			
				
			};

			docReady(meetingCalendarInit);



			introJs().setOptions({
  steps: [{
    title: 'Welcome',
    intro: 'Hello World! 👋'
  },
  {
    element: document.querySelector('.btnCreateMeeting'),
    intro: 'This <b>STEP</b> focuses on an image. <br/> We also used some HTML tags!'
  },
  {
    title: 'Farewell!',
    element: document.getElementById('#addEventModa'),
    intro: '<img src="https://images.unsplash.com/photo-1608096299210-db7e38487075?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=80" />'
  }]
}).start();
		})
	</script>
{% endblock %}
