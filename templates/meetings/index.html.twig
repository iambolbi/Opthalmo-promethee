{% extends 'base.html.twig' %}

{% block title %}Hopital | Rendez-Vous{% endblock %}

{% block base_content %}

      
  <div class="card mb-3 overflow-hidden">
    <div class="card-header">
      <div class="row gx-0 align-items-center">
        <div class="col-auto d-flex justify-content-end order-md-1"><button class="btn icon-item icon-item-sm shadow-none p-0 me-1 ms-md-2" type="button" data-event="prev" data-bs-toggle="tooltip" title="Previous"><span class="fas fa-arrow-left"></span></button><button class="btn icon-item icon-item-sm shadow-none p-0 me-1 me-lg-2" type="button" data-event="next" data-bs-toggle="tooltip" title="Next"><span class="fas fa-arrow-right"></span></button></div>
        <div class="col-auto col-md-auto order-md-2">
          <h4 class="mb-0 fs-0 fs-sm-1 fs-lg-2 calendar-title"></h4>
        </div>
        <div class="col col-md-auto d-flex justify-content-end order-md-3"><button class="btn btn-falcon-primary btn-sm" type="button" data-event="today">Aujourd'hui</button></div>
        <div class="col-md-auto d-md-none">
          <hr />
        </div>
        <div class="col-auto d-flex order-md-0">
          <button class="btn btn-primary btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#addEventModal"> <span class="fas fa-plus me-2"></span>Creer un rendez-vous</button>
        </div>
        
        <div class="col d-flex justify-content-end order-md-2">

        <button class="btn btn-primary btn-sm me-md-2" type="button" data-bs-toggle="modal" data-bs-target="#addPatientModal"> <span class="far fa-address-card me-2"></span>Patient</button>

       
          
        </div>

      </div>
    </div>
    <div class="card-body p-0">
      <div class="calendar-outline" id="appCalendar"></div>
    </div>
  </div>

  <div class="modal fade" id="addEventModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content border">
        <form id="addEventForm" autocomplete="off">
          <div class="modal-header px-card bg-primary border-bottom-0">
            <h5 class="modal-title text-white">Créer un rendez-vous</h5><button class="btn-close me-n1" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body p-card">

         
          <div class="mb-3">

            <label class="fs-0" for="eventLabel">Medecin</label>
  
            <select class="form-select" id="eventLabel" name="label">
              <option value="" selected="selected">None</option>
              <option value="primary">Business</option>
              <option value="danger">Important</option>
              <option value="success">Personal</option>
              <option value="warning">Must Attend</option>
            </select>
          </div>

          <div class="mb-3">

          <label class="fs-0" for="eventLabel">Patient</label>
      
          <select class="form-select" id="eventLabel" name="label">
            <option value="" selected="selected">None</option>
            <option value="primary">Business</option>
            <option value="danger">Important</option>
            <option value="success">Personal</option>
            <option value="warning">Must Attend</option>
          </select>

          </div>

            <div class="mb-3">
              <label class="fs-0" for="eventStartDate">Date de rendez-vous</label>
              <input class="form-control datetimepicker" id="eventStartDate" type="text" required="required" name="startDate" placeholder="yyyy/mm/dd hh:mm" data-options='{"static":"true","enableTime":"true","dateFormat":"Y-m-d H:i"}' />
            </div>

           
            {# <div class="form-check">
              <input class="form-check-input" type="checkbox" id="eventAllDay" name="allDay" /><label class="form-check-label" for="eventAllDay">All Day</label>
            </div> #}

            {# <div class="mb-3">
               <label class="fs-0">Schedule Meeting</label>
              <div>
                <a class="btn badge-soft-success btn-sm" href="#!"><span class="fas fa-video me-2"></span>Add video conference link</a>
              </div>
            </div> #}

            <div class="mb-3"><label class="fs-0" for="eventDescription">Description</label><textarea class="form-control" rows="3" name="description" id="eventDescription"></textarea></div>
            
          
          </div>
          <div class="card-footer d-flex justify-content-end align-items-center bg-light">
            
            <button class="btn btn-primary px-4" type="submit">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>


  <div class="modal fade" id="addPatientModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content border">
        
          <div class="modal-header px-card bg-primary border-bottom-0">
            <h5 class="modal-title text-white">Creer un nouveau patient</h5><button class="btn-close me-n1" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body p-card">

            <div class="mb-3">
              <label class="fs-0" for="fnPatientNom">Nom</label>
              <input class="form-control fnPatient" id="fnPatientNom" type="text" required="required" name="fnPatientNom"  />
            </div>
            <div class="mb-3"><label class="fs-0" for="fnPatientPrenom">Prenom</label><input class="form-control fnPatient" id="fnPatientPrenom" type="text" name="fnPatientPrenom"  /></div>
            
            <div class="mb-3"><label class="fs-0" for="fnPatientContact">Contact</label><input class="form-control fnPatient" id="fnPatientContact" type="text" required="required" name="fnPatientContact"  /></div>
            <div class="mb-3"><label class="fs-0" for="fnPatientAdresse">Adresse</label><input class="form-control fnPatient" id="fnPatientAdresse" type="text" name="fnPatientAdresse" /></div>
            
          </div>

          <div class="card-footer d-flex justify-content-end align-items-center bg-light">
  
            <button class="btn btn-primary px-4" id="btnCreatePatient" type="button">Enregistrer</button>

          </div>
      
      </div>
    </div>
  </div>
{% endblock %}
{% block addjs %}
  <script>

  $(function() {

    let btnCreatePatient = $('#btnCreatePatient'), btnUpdateService = $('#btnUpdateService'),feServiceId = $('#feServiceId'),feServiceLibelle = $('#feServiceLibelle'),feServiceValeur = $('#feServiceValeur')

    function CreatePatient() {

        let form = JSON.stringify({
            nom: $('#fnPatientNom').val(),
            prenom: $('#fnPatientPrenom').val(),
            contact: $('#fnPatientContact').val(),
            adresse: $('#fnPatientAdresse').val()
           
        })

        console.log("form", form)
        requestPost('{{ path('patients_ctrl_create') }}', form, '.fnPatient', '#btnCreatePatient').then(() => {
            iziToast.destroy();
          
            iziToast.success({
                title: 'Succès',
                message: "Le patient a été créé avec succès",
                position: 'topRight',
            });
            location.reload();
           
        }); 
    }


    function updateService() {
        let form = JSON.stringify({
            id: feServiceId.val(),
            libelle: feServiceLibelle.val(),
            valeur: feServiceValeur.val(),
        })
        requestPost('{{ path('services_ctrl_update') }}', form, '.feService', '#btnUpdateService').then(() => {
            iziToast.destroy();
            iziToast.success({
                title: 'Succès',
                message: "La prestation a été modifié avec succès",
                position: 'topRight',
            });
            location.reload();

           // Turbolinks.visit(window.location.toString());
        });
    }
    btnCreatePatient.on('click', function (){
      
        CreatePatient();
    });
    btnUpdateService.on('click', function (){
        updateService();
    });
    $('.btnEditRow').on('click', function (){
        let dataRowId = $(this).data('row-id');
        requestGet('{{ path('services_ctrl_find') }}?code=' + dataRowId).then((data) => {
            
            console.log("role",data )
            feServiceId.val(data.id);
            feServiceLibelle.val(data.libelle);
            feServiceValeur.val(data.valeur);
            
           
            $('#editServiceModal').modal('show');
        });
    });
    $('.btnDeleteRow').on('click', function (){
        let dataRowId = $(this).data('row-id');
        let dataRowName = $(this).data('row-name');
        Swal.fire({
            title: "Supprimer la ligne ?", text: dataRowName,
            icon: "question",
            showCloseButton: true,
            showCancelButton: true,
            focusConfirm: false,
            confirmButtonText: 'Supprimer',
            cancelButtonText: 'Fermer'
        }).then((result) => {
            if (result.isConfirmed) {
                requestGet('{{ path('services_ctrl_delete') }}?code=' + dataRowId).then(() => {
                    iziToast.destroy();
                    iziToast.success({
                        title: 'Succès',
                        message: "La prestation a été supprimé avec succès",
                        position: 'topRight',
                    });
            location.reload();

                 //   Turbolinks.visit(window.location.toString());
                });
            }
        });
    });


  })
</script>
{% endblock %}